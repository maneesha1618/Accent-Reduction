<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>WebRTC → Inference Test</title>
<style> body { font-family: system-ui, sans-serif; max-width: 800px; margin: 2rem auto; } pre { background:#111; color:#eee; padding:1rem; border-radius:8px; } </style>
</head>
<body>
<h1>Mic → WebRTC → aiortc → VAD → Faster-Whisper</h1>
<button id="btn">Start</button>
<pre id="log"></pre>
<script>
const INFER_URL = "http://localhost:8500/offer";
const log = (m) => (document.getElementById('log').textContent += m + "\n");
document.getElementById('btn').onclick = async () => {
const pc = new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"]}]});
const dc = pc.createDataChannel('transcripts');
dc.onmessage = (e) => log(e.data);
const stream = await navigator.mediaDevices.getUserMedia({audio:true});
stream.getTracks().forEach(t => pc.addTrack(t, stream));
const offer = await pc.createOffer();
await pc.setLocalDescription(offer);
const res = await fetch(INFER_URL, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({sdp: offer.sdp, type: offer.type})});
const ans = await res.json();
await pc.setRemoteDescription(ans);
log('Connected. Speak into your mic...');
}
</script>
</body>
</html>